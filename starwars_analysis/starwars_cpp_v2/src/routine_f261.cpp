#include "cpu_0x6809.h"

namespace StarWars {

void routine_0xF261_impl(StarWarsCPU& cpu) {
    // Converted from rom_disasm_auto_0xF261.md
    // Address: 0x0xF261

    // Converted from rom_disasm_auto_0xF261.md
    // Address: 0xROUTINE_0xF261
    // 0xF261: ORCC 0x10
    cpu.state_.cc |= 0x10;
    // 0xF263: CLR 0x0x4684
    cpu.cpu.write_memory(0x4684,  0);
    // 0xF266: LDA 0x00
    cpu.state_.a = 0x00;
    // 0xF268: STA 0x0x4686
    cpu.cpu.write_memory(0x4686,  cpu.state_.a);
    // 0xF26B: STA 0x0x4683
    cpu.cpu.write_memory(0x4683,  cpu.state_.a);
    // 0xF26E: STA 0x0x4682
    cpu.cpu.write_memory(0x4682,  cpu.state_.a);
    // 0xF271: LDA 0x00
    cpu.state_.a = 0x00;
    // 0xF273: STA 0x0x4685
    cpu.cpu.write_memory(0x4685,  cpu.state_.a);
    // 0xF276: LDA 0x80
    cpu.state_.a = 0x80;
    // 0xF278: STA 0x0x4685
    cpu.cpu.write_memory(0x4685,  cpu.state_.a);
    // 0xF27B: STA 0x0x4620
    cpu.cpu.write_memory(0x4620,  cpu.state_.a);
    // 0xF27E: LDU 0x0x0000
    cpu.state_.u = 0x0000;
    // 0xF281: STA 0x0x4640
    cpu.cpu.write_memory(0x4640,  cpu.state_.a);
    // 0xF284: LEAU -0x1,cpu.state_.u
    cpu.state_.u += -0x1,cpu.state_.u;
    // 0xF286: CMPU 0x0x0000
    // TODO: Convert CMPU 0x0x0000
    // 0xF28A: BNE 0x0xF281
    if (!cpu.cpu.zero_flag()) cpu.state_.pc += 0xF281;
    // 0xF28C: LDS 0x0x4FFF
    cpu.state_.sp = 0x4FFF;
    // 0xF290: LDA 0x48
    cpu.state_.a = 0x48;
    // 0xF292: TFR cpu.state_.a,cpu.state_.dp
    cpu.state_.cpu.state_.dp = cpu.state_.cpu.state_.a;
    // 0xF294: STA 0x0x46E0
    cpu.cpu.write_memory(0x46E0,  cpu.state_.a);
    // 0xF297: LDA 0x00
    cpu.state_.a = 0x00;
    // 0xF299: STA 0x0x4400
    cpu.cpu.write_memory(0x4400,  cpu.state_.a);
    // 0xF29C: LDX 0x0x4800
    cpu.state_.x = 0x4800;
    // 0xF29F: LDD 0x0x0000
    cpu.state_.d = 0x0000;
    // 0xF2A2: STD ,cpu.state_.x++
    cpu.cpu.write_memory(0, cpu.state_.x++,  cpu.state_.d);
    // 0xF2A4: CMPX 0x0x5000
    cpu.cpu.compare_x(0x5000);
    // 0xF2A7: BCS 0x0xF2A2
    if (cpu.cpu.carry_flag()) cpu.state_.pc += 0xF2A2;
    // 0xF2A9: STA 0x0x4640
    cpu.cpu.write_memory(0x4640,  cpu.state_.a);
    // 0xF2AC: LDX 0x0x5000
    cpu.state_.x = 0x5000;
    // 0xF2AF: LDD 0x0x0000
    cpu.state_.d = 0x0000;
    // 0xF2B2: STD ,cpu.state_.x++
    cpu.cpu.write_memory(0, cpu.state_.x++,  cpu.state_.d);
    // 0xF2B4: STA 0x0x4640
    cpu.cpu.write_memory(0x4640,  cpu.state_.a);
    // 0xF2B7: CMPX 0x0x6000
    cpu.cpu.compare_x(0x6000);
    // 0xF2BA: BCS 0x0xF2B2
    if (cpu.cpu.carry_flag()) cpu.state_.pc += 0xF2B2;
    // 0xF2BC: LDX 0x0x0000
    cpu.state_.x = 0x0000;
    // 0xF2BF: LDD 0x0x0000
    cpu.state_.d = 0x0000;
    // 0xF2C2: STD ,cpu.state_.x++
    cpu.cpu.write_memory(0, cpu.state_.x++,  cpu.state_.d);
    // 0xF2C4: STA 0x0x4640
    cpu.cpu.write_memory(0x4640,  cpu.state_.a);
    // 0xF2C7: CMPX 0x0x3000
    cpu.cpu.compare_x(0x3000);
    // 0xF2CA: BCS 0x0xF2C2
    if (cpu.cpu.carry_flag()) cpu.state_.pc += 0xF2C2;
    // 0xF2CC: LDA 0x0x4300
    cpu.state_.a = 0x4300;
    // 0xF2CF: ANDA 0x10
    cpu.state_.a &= 0x10;
    // 0xF2D1: BNE 0x0xF2D6
    if (!cpu.cpu.zero_flag()) cpu.state_.pc += 0xF2D6;
    // 0xF2D3: JMP 0x0xF36E
    cpu.state_.pc = 0xF36E;
}

} // namespace StarWars
